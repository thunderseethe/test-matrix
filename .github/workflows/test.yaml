name: Build Matrix
'on':
  workflow_run:
    workflows: ["Update Crubit and Test Matrix"]
    types:
      - completed
  workflow_dispatch: null
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        rust_version:
          - nightly-2026-01-27
          - nightly-2026-01-28
          - nightly-2026-01-29
          - nightly-2026-01-30
          - nightly-2026-01-31
          - nightly-2026-02-01
          - nightly-2026-02-02
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          # submodules: true ensures the submodule folder exists to be updated
          submodules: true
          # fetch-depth: 0 ensures we have history to push back
          fetch-depth: 0
      - name: Install Rust Toolchain
        uses: actions-rust-lang/setup-rust-toolchain@v1
        with:
          toolchain: ${{ matrix.rust_version }}
          components: "rust-src, rustc-dev, llvm-tools-preview"
      - name: Build Binary
        id: cargo_build
        run: cd crubit; RUST_TOOLCHAIN=${{ matrix.rust_version }} cargo check --bin cc_bindings_from_rs
      - name: Final Status Notification
        if: always()
        run: "if [[ \"${{ job.status }}\" == \"success\" ]]; then\n  echo \"✅ Build passed for ${{ matrix.rust_version }}\"\nelse\n  echo \"❌ Build failed for ${{ matrix.rust_version }}\"\nfi\n"
